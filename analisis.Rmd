---
title: "Investigación"
description: |
  Buenos Aires Vecinal
site: distill::distill_website
---

# LIBRERIAS

```{r, include=FALSE}
options(scipen = 999)

knitr::opts_chunk$set(echo = TRUE)
library(bootstrap)
library(bslib)
library(data.table)
library(dplyr)
library(DT)
library(geofacet)
library(ggmap)
library(ggplot2)
library(googlesheets4)
library(installr)
library(janitor)
library(knitr)
library(leaflet)
library(leaflet.extras)
library(lubridate)
library(lwgeom)
library(maptools)
library(openxlsx)
library(osmdata)
library(osrm)
library(plotly)
library(purrr)
library(RColorBrewer)
library(readxl)
library(readr)
library(rgdal)
library(rgeos)
library(rmarkdown)
library(rsconnect)
library(scales)
library(sf)
#library(shiny)
#library(shinydashboard)
#library(shinyjs)
library(sodium)
library(sp)
library(stringr)
library(tidygeocoder)
library(tidyr)
library(tidyverse)
library(viridis)
library(viridisLite)
library(vroom)
library(writexl)
```

<h1>
BUENOS AIRES EN 15 MINUTOS </br>
  <small class="text-muted"> || Hipótesis </small>
</h1>


<h3>
  LA PREGUNTA </br>
  <small class="text-muted"> |  Nacional </small>
</h3>

**HIPÓTESIS**



#BASES DE DATOS
```{r, echo = FALSE, warning = FALSE, out.width = "100%"}
gs4_deauth() # Eliminar auth interactivo (link publico)
variables = read_sheet("https://docs.google.com/spreadsheets/d/15K_hQPI8NeN-vGZoND9f9yWvzg82VgPx-S1nffsJ3LQ/edit#gid=0")

```


#BARRIOS

```{r, echo = FALSE, warning = FALSE, out.width = "100%"}
barrios <- st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-educacion/barrios/barrios.geojson") %>% 
  mutate(AREAKM2 = round((AREA/1000000),2)) %>% 
  st_transform(4326)


centroides = st_centroid(barrios) %>% 
             st_transform(4326)

puntos_aleatorios <- rowwise(barrios) %>%
  mutate(punto_aleatorio = st_sample(geometry, 1, type = "random")) %>% 
  st_drop_geometry(geometry) %>% 
  st_as_sf()
```
#ISOCRONAS


```{r, echo = FALSE, warning = FALSE, out.width = "100%"}
#ESTA SECCIÓN VOY A EJECUTARLA UNA SOLA VEZ Y GUARDO EL OBJETO PORQUE TARDA MUCHO:
# itero en cada punto para hacer las isocronas
#lista_isocronas <- lapply(puntos_aleatorios$punto_aleatorio, function(point) {
#  osrmIsochrone(loc = st_coordinates(point),
#                breaks = seq(from = 0, to = 15, by = 15),
#                res = 40,
#                osrm.profile = "foot")
#})

# Combino las isocronas
#isocronas_bind <- do.call(rbind, lista_isocronas)

#st_write(isocronas_bind, "data/isocronas_aleatorios.geojson")

#Ahora simplemente llamo la base que armé y le uno los nombres por orden de las observaciones
isocronas_barrios = st_read("data/isocronas_aleatorios.geojson") %>% 
                    st_transform(4326) %>% 
                    cbind(st_drop_geometry(centroides)) %>% 
                    st_make_valid()

#Hago una base simplificada para relacionar con los puntos
isocronas_inter = isocronas_barrios %>% 
                          select(BARRIO)
```

# MAPA

pal_tenencia <- colorFactor(
  palette = brewer.pal(10, "OrRd"), # Cambia la paleta y el número de colores según tu preferencia
  domain = tenencia_prov$inquilinos
)

```{r, echo = FALSE, warning = FALSE, out.width = "100%"}

leaflet(st_zm(barrios) %>% st_transform(4326)) %>%
  addTiles() %>%
  addProviderTiles(providers$CartoDB.Positron, group = "OSM",
                   options = providerTileOptions(minzoom = 1, maxzoom = 15)) %>%
  addProviderTiles(providers$Esri.WorldImagery, group = "Satelite") %>%
  addLayersControl(
    baseGroups = c("OSM","Satelite"), 
    overlayGroups = c("Barrios CABA", "Centroides","Puntos Aleatorios","Puntos Aleatorios2","Isocrona"))%>% 
  
  addPolygons(data= barrios,
              color = "black",
              weight = 0.4,
              opacity = 0.7,
              fillColor = "white",
              fillOpacity = 0.5,
              popup = ~paste("<strong> BARRIO: </strong>", BARRIO,"<br> <strong> ÁREA: </strong>", AREAKM2, "km2"),
              group = "Barrios CABA") %>% 
  
    addCircleMarkers(data=puntos_aleatorios,
              fillColor = "green",
              weight = 0.5,
              color = "green",
              fillOpacity = 0.5,
              radius = 2,
              popup = ~paste("<strong> BARRIO: </strong>", BARRIO),
              group = "Puntos Aleatorios")  %>% 

  addPolygons(data= isocronas_barrios,
              color = "darkgreen",
              weight = 0.4,
              opacity = 0.7,
              fillColor = "darkgreen",
              fillOpacity = 0.5,
              popup = ~paste("<strong> BARRIO: </strong>", BARRIO),
              group = "Isocrona")

```

#BBOX Y FUNCIONES

```{r, echo = FALSE, warning = FALSE, out.width = "100%"}
conteo_interno = function(db, nombre_variable){
  db %>% 
  st_transform(4326) %>% 
  st_intersection(isocronas_inter) %>%
  group_by(BARRIO) %>%
  summarise(!!nombre_variable := n())
}

#DEFINO LA BBOX DE CABA PARA LIMITAR BUSQUEDAS EN OSM
bbox_caba <- getbb("Ciudad Autónoma de Buenos Aires, Argentina")

#DEFINO UNA FUNCION PARA HACER BUSQUEDAS E OSM

buscar_osm <- function(nombre_objeto, clave) {
  opq_objeto <- opq(bbox_caba)
  opq_objeto <- add_osm_feature(opq_objeto, key = clave)
  opq_objeto <- osmdata_sf(opq_objeto)
  
  assign(nombre_objeto, opq_objeto, envir = .GlobalEnv)
}
```

# SEGURIDAD
```{r, echo = FALSE, warning = FALSE, out.width = "100%"}
#TOMO CADA BASE DE DATOS, LA INTERSECTO Y HAGO EL CONTEO:

se_comisarias = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-justicia-y-seguridad/comisarias-policia-ciudad/comisarias-policia-de-la-ciudad.geojson") %>% 
  select(nombre, nom_2,tipo) %>% 
  conteo_interno("n_se_comisarias")
  
  
se_bomberos = read.csv("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-justicia-y-seguridad/cuarteles-destacamentos-bomberos/cuarteles-y-destacamentos-de-bomberos-de-policia-federal-argentina.csv",
                    stringsAsFactors = T) %>% 
  select(long,lat,dcia,gestion) %>% 
  st_as_sf(coords = c("long", "lat"), crs = 4326) %>% 
  conteo_interno("n_se_bomberos")

```


# SALUD
```{r, echo = FALSE, warning = FALSE, out.width = "100%"}
s_ufebriles = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-salud/ufus/ubicacion-ufus.geojson")  %>% 
  conteo_interno("n_s_ufebriles")

s_cimujer = read.xlsx("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-desarrollo-humano-y-habitat/centros-integrales-mujer/centros-integrales-de-la-mujer.xlsx") %>% 
  filter(!is.na(lat)) %>% 
  st_as_sf(coords = c("long", "lat"), crs = 4326) %>% 
  conteo_interno("n_s_cimujer")

s_hospitales = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-salud/hospitales/hospitales.geojson")  %>% 
  conteo_interno("n_s_hospitales")

s_cdinfantil = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-desarrollo-humano-y-habitat/centros-desarrollo-infantil/centros-de-desarrollo-infantil.geojson")  %>% 
  conteo_interno("n_s_cdinfantil")

s_farmacias = read.xlsx("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-salud/farmacias/farmacias.xlsx") %>% 
  filter(!is.na(lat)) %>% 
  st_as_sf(coords = c("long", "lat"), crs = 4326) %>% 
  conteo_interno("n_s_farmacias")

s_privados = read.xlsx("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-salud/centros-salud-privados/centros-de-salud-privados.xlsx") %>% 
  filter(!is.na(lat)) %>% 
  st_as_sf(coords = c("long", "lat"), crs = 4326) %>% 
  conteo_interno("n_s_privados")

s_vinfantil = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-salud/vacunatorios-infantiles/vacunatorios_infantiles_WGS84.geojson")  %>% 
  conteo_interno("n_s_vinfantil")

s_cesac = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-salud/centros-salud-accion-comunitaria-cesac/centros_de_salud_nivel_1_BADATA_WGS84.geojson")  %>% 
  conteo_interno("n_s_cesac")

s_vmayores = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-salud/vacunatorios-adultos-mayores/vacunatorios-adultos-mayores.geojson")  %>% 
  conteo_interno("n_s_vmayores")

s_barriales = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-salud/centros-medicos-barriales/centros-medicos-barriales.geojson")  %>% 
  conteo_interno("n_s_barriales")

s_geriatricos = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-justicia-y-seguridad/geriatricos/geriatricos.geojson")  %>% 
  conteo_interno("n_s_geriatricos")

s_esaludables = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/vicejefatura-de-gobierno/estaciones-saludables/estaciones-saludables.geojson")  %>% 
  conteo_interno("n_s_esaludables")

s_veterinarias = read.xlsx("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/agencia-de-proteccion-ambiental/centros-atencion-veterinaria/centros-de-atencion-veterinaria.xlsx") %>% 
  filter(!is.na(lat)) %>% 
  st_as_sf(coords = c("long", "lat"), crs = 4326) %>% 
  conteo_interno("n_s_veterinarias")

```

# CULTURA Y RECREACION
```{r, echo = FALSE, warning = FALSE, out.width = "100%"}
r_culturales = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-cultura/espacios-culturales/espacios-culturales.geojson")  %>% conteo_interno("n_r_culturales")

r_jugotecas = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-desarrollo-humano-y-habitat/juegotecas-barriales/juegotecas-barriales.geojson") %>% 
  conteo_interno("n_r_jugotecas")

r_monumentos = read.xlsx("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-espacio-publico-e-higiene-urbana/monumentos/monumentos.xlsx") %>% 
  filter(!is.na(LATITUD)) %>% 
  st_as_sf(coords = c("LONGITUD", "LATITUD"), crs = 4326) %>% 
  conteo_interno("n_r_monumentos") %>% 
  filter(!is.na(BARRIO))

r_estadios = read.xlsx("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/vicejefatura-de-gobierno/estadios/estadios.xlsx") %>% 
  st_as_sf(coords = c("long", "lat"), crs = 4326) %>% 
  conteo_interno("n_r_estadios") 

r_peatonal = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-desarrollo-humano-y-habitat/juegotecas-barriales/juegotecas-barriales.geojson") %>% 
  conteo_interno("n_r_peatonal")

r_gastronomicos = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ente-de-turismo/oferta-establecimientos-gastronomicos/oferta-gastronomica.geojson") %>% 
  conteo_interno("n_r_gastronomicos")

r_jubilados = read.xlsx("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-desarrollo-humano-y-habitat/centros-jubilados/centros-de-jubilados-reempadronados.xlsx") %>% 
  filter(!is.na(lat)) %>% 
  st_as_sf(coords = c("long", "lat"), crs = 4326) %>% 
  conteo_interno("n_r_jubilados") 

#TRABAJO SOBRE LA BASE DE DATOS DE LOCALES BAILABLES PARA ASIGNAR GEOMETRIA EN BASE A LAS DIRECCIONES DISPONIBLES:

#r_bailables = read.xlsx("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/agencia-gubernamental-de-control/locales-bailables/locales_bailables.xlsx")%>% 
  #clean_names() %>% 
  #mutate(direccion = paste0(domicilio," ",no, ", Ciudad de Buenos Aires, Argentina")) %>% 
  #filter(!grepl("VENCI|SUSP|BAJA|DENE", estado)) %>% 
  #filter(!is.na(estado)) 

#evito problemas por cortes en la busqueda y después guardo el archivo y desactivo esta parte del código porque se demora mucho
#Sys.sleep(1)

#r_bailables = r_bailables %>%
  #geocode(address = direccion, method = "osm")

#r_bailables = r_bailables %>%
  #filter(!is.na(lat)) %>% 
  #st_as_sf(coords = c("long", "lat"), crs = 4326) %>% 
  #st_write("data/r_bailables.geojson")

r_bailables =  st_read("data/r_bailables.geojson") %>% 
  conteo_interno("n_r_bailables") 
```

#DEPORTES

```{r}
d_skate = read.csv("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/vicejefatura-de-gobierno/pistas-skate/pistas-de-skate.csv",
                    stringsAsFactors = T) %>% 
  st_as_sf(coords = c("long", "lat"), crs = 4326) %>% 
  conteo_interno("n_d_skate")

d_polideportivos = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/vicejefatura-de-gobierno/polideportivos/polideportivos.geojson")  %>% 
  conteo_interno("n_d_polideportivos")

d_clubes = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/vicejefatura-de-gobierno/clubes/clubes.geojson") %>% 
  conteo_interno("n_d_clubes")
```


#EDUCACION
```{r, echo = FALSE, warning = FALSE, out.width = "100%"}
e_jardinesc = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-desarrollo-humano-y-habitat/jardines-comunitarios/jardin_comunitario.geojson") %>% 
  conteo_interno("n_e_jardinesc")

e_primerainfancia = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-desarrollo-humano-y-habitat/centros-primera-infancia/centros-de-primera-infancia.geojson") %>% 
  conteo_interno("n_e_primerainfancia")

e_desarrolloi = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-desarrollo-humano-y-habitat/centros-desarrollo-infantil/centros-de-desarrollo-infantil.geojson") %>% 
  conteo_interno("n_e_desarrolloi")

e_educativos = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-educacion/establecimientos-educativos/establecimientos_educativos_WGS84.geojson") %>% 
  conteo_interno("n_e_educativos")

e_universidades = read.xlsx("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-educacion/universidades/universidades.xlsx") %>% 
  filter(!is.na(lat)) %>% 
  st_as_sf(coords = c("long", "lat"), crs = 4326) %>% 
  conteo_interno("n_e_universidades") 

e_bibliotecas = read.xlsx("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-cultura/bibliotecas/bibliotecas.xlsx") %>% 
  filter(!is.na(lat)) %>% 
  st_as_sf(coords = c("long", "lat"), crs = 4326) %>% 
  conteo_interno("n_e_bibliotecas") 

```

#TRAMITES
```{r, echo = FALSE, warning = FALSE, out.width = "100%"}
#OBTENGO LOS PUNTOS DE ATENCION CIUDADANA BUSCANDO LAS DIRECCIONES QUE FIGURAN EN LA BASE DE DATOS:

#t_puntos = read.xlsx("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-gobierno/puntos-atencion/puntos-de-atencion.xlsx") %>% 
#  mutate(direccion = paste0(calle_nombre," ",calle_altura, ", Ciudad de Buenos Aires, Argentina"))

#evito problemas por cortes en la busqueda y después guardo el archivo y desactivo esta parte del código porque se demora mucho
#Sys.sleep(1)

#t_puntos = t_puntos %>%
#  geocode(address = direccion, method = "osm")

#st_write(t_puntos, "data/t_puntos.geojson")

t_puntos = st_read("data/t_puntos.geojson") %>% 
  filter(!is.na(lat)) %>% 
  st_drop_geometry(geometry) %>% 
  st_as_sf(coords = c("long", "lat"), crs = 4326) %>% 
  conteo_interno("n_t_puntos")


t_vtv = read.xlsx("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/transporte-y-obras-publicas/verificacion-tecnica-vehicular-vtv/verificacion-tecnica-vehicular.xlsx") %>% 
  filter(!is.na(lat)) %>% 
  st_as_sf(coords = c("long", "lat"), crs = 4326) %>% 
  conteo_interno("n_t_vtv")

t_cajeros = read.xlsx("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/secretaria-de-desarrollo-urbano/cajeros-automaticos/cajeros-automaticos.xlsx") %>% 
  filter(!is.na(lat)) %>% 
  st_as_sf(coords = c("long", "lat"), crs = 4326) %>% 
  select(id)

t_bancos = read.xlsx("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-economia-y-finanzas/bancos/bancos.xlsx") %>% 
  filter(!is.na(lat)) %>% 
  st_as_sf(coords = c("long", "lat"), crs = 4326) %>% 
  select(id)

t_bancosyc = rbind(t_bancos,t_cajeros) %>% 
  mutate(geos = as.character(geometry)) %>% 
  filter(!duplicated(geos)) %>% 
  conteo_interno("n_t_bancosyc")

```
#AUTOABASTECIMIENTO
```{r, echo = FALSE, warning = FALSE, out.width = "100%"}
#HAGO UNA BUQUEDA DE LOS COMERCIOS CON OSM, GUARDO LA NUEVA BASE Y EDSHABILITO EL PROCESO PARA NO REPETIRLO:

#buscar_osm("a_comercio", "shop")

#a_comercio_pt = a_comercio$osm_points %>% 
#  select(name)

#a_comercio_mpol = a_comercio$osm_multipolygons %>% 
#  select(name) %>% 
#  st_centroid() %>% 
#  st_transform(4326)

#a_comercio_pol = a_comercio$osm_polygons %>% 
#  select(name)%>% 
#  st_centroid() %>% 
#  st_transform(4326)

#a_comercio = rbind(a_comercio_pt,a_comercio_pol,a_comercio_mpol) %>% 
#  conteo_interno("n_a_comercio")

#st_write(a_comercio, "data/a_comercio.geojson")

a_comercio = st_read("data/a_comercio.geojson")

a_ferias = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-espacio-publico-e-higiene-urbana/ferias-mercados/ferias-itinerantes-de-abastecimiento-barrial.geojson") %>% 
  conteo_interno("n_a_ferias")

#CONSTRUYO LA BASE DE FLORERIAS CON LAS DIRECCIONES:

#a_florerias = read.xlsx("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/atencion-ciudadana/puestos-de-flores/puestos-flores.xlsx") %>% 
#  mutate(direccion = paste0(Calle, " ", Altura, ", Ciudad de Buenos Aires, Argentina"))

#evito problemas por cortes en la busqueda y después guardo el archivo y desactivo esta parte del código porque se demora mucho
#Sys.sleep(1)

#a_florerias = a_florerias %>%
#  geocode(address = direccion, method = "osm")

#a_florerias = a_florerias %>% 
#  filter(!is.na(lat)) %>% 
#  st_as_sf(coords = c("long", "lat"), crs = 4326) %>% 
#  conteo_interno("n_a_florerias")

#st_write(a_florerias, "data/a_florerias.geojson")

a_florerias = st_read("data/a_florerias.geojson")

a_eess = read.xlsx("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-educacion/estaciones-servicio/estaciones_servicio_caba.xlsx") %>% 
  filter(!is.na(lat)) %>% 
  st_as_sf(coords = c("long", "lat"), crs = 4326) %>% 
  conteo_interno("n_a_eess")

```

#TRANSPORTE

```{r, echo = FALSE, warning = FALSE, out.width = "100%"}
tp_colectivos = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/transporte-y-obras-publicas/colectivos-paradas/paradas-de-colectivo.geojson") %>% 
  conteo_interno("n_tp_colectivos")

tp_bicis = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/transporte-y-obras-publicas/estaciones-bicicletas-publicas/nuevas-estaciones-bicicletas-publicas.geojson") %>% 
  conteo_interno("n_tp_bicis")

tp_subte = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/sbase/subte-estaciones/estaciones-de-subte.geojson") %>% 
  conteo_interno("n_tp_subte")

tp_ffcc = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/transporte-y-obras-publicas/estaciones-ferrocarril/estaciones-de-ferrocarril.geojson") %>% 
  conteo_interno("n_tp_ffcc")

tp_garagec = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/transporte-y-obras-publicas/garajes-comerciales/garajes-comerciales.geojson") %>% 
  conteo_interno("n_tp_garagec")

tp_garagem = read.xlsx("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/transporte-y-obras-publicas/estacionamientos-motos/estacionamientos-de-motos-publico.xlsx") %>% 
  filter(!is.na(lat)) %>% 
  st_as_sf(coords = c("long", "lat"), crs = 4326) %>% 
  conteo_interno("n_tp_garagem")

```

#MEDIO AMBIENTE
```{r}
#mb_arbolado = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/atencion-ciudadana/arbolado-publico-lineal/arbolado-publico-lineal-2017-2018.geojson") %>% 
#  conteo_interno("n_tp_arbolado")

mb_eevv = st_read("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/secretaria-de-desarrollo-urbano/espacios-verdes/espacio_verde_publico.geojson") %>% 
  st_make_valid() %>% 
  st_centroid() %>% 
  #hacer una ponderacion por tipo de espacio verde
  mutate(clasificac = as.factor(clasificac)) %>% 
  conteo_interno(n_mb_eevv)
```


#UNIFICADO
```{r}
#PARA ELIMINAR OBJETOS DE MI ENTORNO QUE NO USÉ AL FINAL
#rm(a_rcivil)

#LLAMO TODAS LAS BASES DE DATOS Y LAS FILTRO SEGUN SI SON DE LAS CATEGORIAS DE ANALISIS
bases_de_datos <- ls() %>%
  grep("^a_|^d_|^e_|^r_|^s_|^se_|^t_", ., value = TRUE) %>%
  lapply(get)

# ARMO UNA BASE UNIFICADA HACIENDO LEFT_JOINS ITERATIVOS CON AS BD
isocronas_datos <- bases_de_datos %>% 
  reduce(function(df1, df2) {
    left_join(df1, df2 %>% st_drop_geometry(), by = "BARRIO") %>%
      replace(is.na(.), 0)
  }, .init = isocronas_barrios)
```


#PONDERACIONES
Si bien la rigurosidad metodologia de estas ponderaciones es practicamente inexistente debido a que no tiene un respaldo teorico, sino que se basa en mi subjetividad, la idea es plantear al menos algun tipo de diferencia en el peso de cada subitem de los indices para reconocer que no deberían ser iguales; y dejar asentada una forma de calcularlo.



#MAPA con puntos

leaflet(st_zm(barrios) %>% st_transform(4326)) %>%
  addTiles() %>%
  addProviderTiles(providers$CartoDB.Positron, group = "OSM",
                   options = providerTileOptions(minzoom = 1, maxzoom = 15)) %>%
  addProviderTiles(providers$Esri.WorldImagery, group = "Satelite") %>%
  addLayersControl(
    baseGroups = c("OSM","Satelite"), 
    overlayGroups = c("Barrios CABA", "Comisarias", "Isocronaa"))%>% 
  
  addPolygons(data= barrios,
              color = "black",
              weight = 0.4,
              opacity = 0.7,
              fillColor = "white",
              fillOpacity = 0.5,
              popup = ~paste("<strong> BARRIO: </strong>", BARRIO,"<br> <strong> ÁREA: </strong>", AREAKM2, "km2"),
              group = "Barrios CABA") %>% 
  
  addCircleMarkers(data=comisarias_dentro,
              fillColor = "purple",
              weight = 0.5,
              color = "purple",
              fillOpacity = 0.5,
              radius = 2,
              #popup = ~paste("<strong> BARRIO: </strong>", BARRIO),
              group = "Comisarias")%>% 

  addPolygons(data= isocronas_barrios,
              color = "darkgreen",
              weight = 0.4,
              opacity = 0.7,
              fillColor = "darkgreen",
              fillOpacity = 0.5,
              popup = ~paste("<strong> BARRIO: </strong>", BARRIO),
              group = "Isocronas")



